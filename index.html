<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Curso Leaflet</title>
	<link rel="stylesheet" type="text/css" href="src/leaflet.css" />
	<link rel="stylesheet" type="text/css" href="src/css/bootstrap.css" />
	<script type="text/javascript" src="src/leaflet-src.js"></script>
	<script type="text/javascript" src="src/jquery-3.2.1.min.js"></script>
	<style type="text/css">
		#mapdiv { height: 100vh; }
	</style>
</head>
<body>
	<div id="side-bar" class="col-md-3"></div>
	<div id="mapdiv" class="col-md-9"></div>


	<script type="text/javascript">
		
		var mymap;
		var lyrOSM;
		var mrkCurrentLocation;

		$(function(){

			mymap = L.map('mapdiv', {
								center: [19.4, -99.2],
								zoom: 13
							});
			lyrOSM = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');
			
			mymap.addLayer(lyrOSM);

			setInterval(function(){
				mymap.locate();
			}, 5000);

			mymap.on('click', function(e){
				//console.log(e);
				if (e.originalEvent.shiftKey) {
					alert(mymap.getZoom());
				}
				else {
					alert(e.latlng.toString());
				}			
			});


			mymap.on('contextmenu', function(e){
				var dtCurrentTime = new Date();
				L.marker(e.latlng).addTo(mymap).bindPopup(e.latlng.toString() + "<br/>" + dtCurrentTime.toString());
			});

			mymap.on('keypress', function(e){
				if (e.originalEvent.key=="l") {
					mymap.locate();
				}
			});

			mymap.on('locationfound', function(e){
				console.log(e);
				if (mrkCurrentLocation) {
					mrkCurrentLocation.remove();
				}
				mrkCurrentLocation = L.circleMarker(e.latlng).addTo(mymap);
				mymap.setView(e.latlng, 14);
			});

			mymap.on('locationerror', function(e){
				console.log(e);
				alert("Location was not found");
			});


		});
		
	</script>
</body>
</html>